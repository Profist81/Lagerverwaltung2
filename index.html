<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles.css" />
  <title>Lagerverwaltung</title>
</head>
<body>
  <header class="app-header">
    <h1>Lagerverwaltung</h1>
    <div class="header-right">
      <div class="status-badges">
        <span id="roleBadge" class="badge">Gast</span>
        <span id="syncBadge" class="badge badge-info" title="Ausstehende Uploads">‚ü≥ 0</span>
        <span id="onlineBadge" class="badge badge-ok">Online</span>
      </div>
      <div class="admin-controls">
        <button id="btnAdminLogin" class="btn btn-ghost">Admin Login</button>
        <button id="btnSetPin" class="btn btn-ghost">PIN setzen</button>
      </div>
    </div>
  </header>

  <section class="search-bar">
    <input id="quickSearch" type="search" inputmode="search" placeholder="LS-Nr. oder Datum (YYYY-MM-DD)" aria-label="Schnellsuche" />
    <button id="btnSearch" class="btn">Suchen</button>
  </section>

  <main class="grid">
    <!-- Erfassung: Wareneingang ‚Äì ohne Zeichnung -->
    <section class="card">
      <header class="card-header">
        <h2>Wareneingang ‚Äì ohne Zeichnung</h2>
      </header>
      <form id="formInbound" class="form">
        <label for="lsnr"><strong>Lieferscheinnummer *</strong></label>
        <div class="field-row">
          <input id="lsnr" name="lsnr" type="text" required autocomplete="off" />
          <button id="btnScan" type="button" class="btn btn-ghost" title="Barcode-Scan (optional)">üéØ</button>
        </div>

        <label for="supplier"><strong>Lieferant *</strong></label>
        <input id="supplier" name="supplier" list="supplierList" required autocomplete="off" />
        <datalist id="supplierList"></datalist>

        <label for="dateDoc"><strong>Datum *</strong></label>
        <input id="dateDoc" name="dateDoc" type="date" required />

        <div id="dupWarning" class="note note-warn hidden">
          Doppelte LS-Nr. f√ºr Datum/Lieferant erkannt. Teillieferung zulassen?
          <label class="inline"><input type="checkbox" id="chkForce" /> bewusst anlegen</label>
        </div>

        <div class="row gap">
          <button id="btnSaveAndShoot" type="submit" class="btn primary">Speichern &amp; fotografieren</button>
          <button id="btnSaveOnly" type="button" class="btn">Nur speichern</button>
        </div>
      </form>

      <ul id="listOhne" class="list"></ul>
    </section>

    <!-- Wareneingang ‚Äì mit Zeichnung -->
    <section class="card">
      <header class="card-header">
        <h2>Wareneingang ‚Äì mit Zeichnung</h2>
      </header>
      <ul id="listMit" class="list"></ul>
    </section>

    <!-- Detail / Treffer -->
    <section class="card">
      <header class="card-header">
        <h2>Treffer &amp; Details</h2>
      </header>
      <div id="results" class="results"></div>
    </section>

    <!-- DnD Board & Einkaufskorb -->
    <section class="card wide">
      <header class="card-header">
        <h2>Best√§nde &amp; Fluss (Drag &amp; Drop)</h2>
        <div class="row">
          <button id="btnAddBin" class="btn">Lagerplatz hinzuf√ºgen</button>
          <label class="switch">
            <input id="toggleAskPartial" type="checkbox" checked />
            <span>Teilmenge beim Drop abfragen</span>
          </label>
        </div>
      </header>

      <div id="board" class="board noselect" aria-label="Drag & Drop Zonen">
        <div class="col dropzone" data-zone="Best√§nde" data-ask-partial="1">
          <h3>Best√§nde</h3>
          <ul class="items" id="zone-best"></ul>
        </div>
        <div class="col dropzone" data-zone="Wareneingang" data-ask-partial="1">
          <h3>Wareneingang</h3>
          <ul class="items" id="zone-inbound"></ul>
        </div>
        <div class="col dropzone" data-zone="Lagerplatz" data-ask-partial="1">
          <h3>Lagerplatz</h3>
          <ul class="items" id="zone-storage"></ul>
        </div>
        <div class="col dropzone" data-zone="Pulverbeschichtung" data-ask-partial="1">
          <h3>Pulverbeschichtung</h3>
          <ul class="items" id="zone-pbs"></ul>
        </div>
        <div class="col dropzone" data-zone="Roboter" data-ask-partial="1">
          <h3>Roboter</h3>
          <ul class="items" id="zone-robot"></ul>
        </div>
      </div>

      <div class="divider"></div>

      <header class="card-header">
        <h2>Einkaufsliste / Korb</h2>
        <div class="row">
          <button id="btnExportCSV" class="btn">CSV exportieren</button>
          <button id="btnExportPDF" class="btn">PDF exportieren</button>
          <button id="btnClearCart" class="btn btn-ghost">Korb leeren</button>
        </div>
      </header>
      <table class="table" id="cartTable" aria-label="Einkaufskorb">
        <thead><tr><th>Menge</th><th>Bezeichnung</th><th>Notiz</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Admin -->
    <section class="card">
      <header class="card-header">
        <h2>Admin</h2>
      </header>
      <div class="admin-only" id="adminPanel" hidden>
        <label class="switch">
          <input id="toggleHomeLock" type="checkbox" />
          <span>Sperre Heimatplatz</span>
        </label>
        <label class="switch">
          <input id="toggleOverride" type="checkbox" />
          <span>Override erlauben</span>
        </label>
      </div>
      <div class="note">Gesch√ºtzte Schalter nur mit Admin-Status √§nderbar.</div>
    </section>
  </main>

  <!-- Dialogs / Modals -->
  <dialog id="dlgCamera" class="modal">
    <form method="dialog" class="modal-body">
      <header class="modal-header">
        <h3>Lieferschein fotografieren</h3>
        <button class="btn btn-ghost close" value="cancel" aria-label="Schlie√üen">‚úï</button>
      </header>

      <div id="cameraArea" class="camera">
        <video id="video" playsinline autoplay muted></video>
        <canvas id="canvas" class="hidden"></canvas>
        <img id="photoPreview" class="hidden" alt="Vorschau" />
        <input id="fileInput" type="file" accept="image/*" capture="environment" class="hidden" />
      </div>

      <div id="cameraHints" class="note">
        Mindestaufl√∂sung ‚â• 1500 px, unscharfe Bilder werden beanstandet.
      </div>

      <div class="row gap">
        <button id="btnTake" type="button" class="btn primary">Weitere Seite</button>
        <button id="btnRetake" type="button" class="btn">Neu aufnehmen</button>
        <button id="btnRotate" type="button" class="btn">Drehen</button>
        <button id="btnDeleteLast" type="button" class="btn btn-ghost">L√∂schen</button>
        <button id="btnDone" type="submit" class="btn">Fertig</button>
      </div>

      <div id="captureList" class="thumbs"></div>
    </form>
  </dialog>

  <dialog id="dlgConfirm" class="modal">
    <form method="dialog" class="modal-body">
      <p>Zeichnung(en) gedruckt und bei der Ware abgelegt?</p>
      <menu>
        <button value="yes" class="btn primary">Ja</button>
        <button value="no" class="btn">Nein</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgMessage" class="modal">
    <form method="dialog" class="modal-body">
      <div id="msgText"></div>
      <menu>
        <button value="ok" class="btn primary">OK</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgPrompt" class="modal">
    <form method="dialog" class="modal-body">
      <label id="promptLabel"></label>
      <input id="promptInput" type="text" />
      <menu>
        <button value="ok" class="btn primary">OK</button>
        <button value="cancel" class="btn">Abbrechen</button>
      </menu>
    </form>
  </dialog>

  <script src="app.js" defer></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
